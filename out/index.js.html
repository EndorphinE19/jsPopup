<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Create from './view/create/popup-close-page-view.js';
import Add from './view/popup-close-page.js';
import ClassPopup from "./classPopup/classPopup";
import ApiData from './apidata/apidata.js';
import validate from './validate/validate.js';
import punycode from './punycode/punycode.js';

const api = new ApiData();
const classPopup = new ClassPopup();
const add = new Add();
const create = new Create();

document.addEventListener("DOMContentLoaded", ready);

function ready() {

    appendLink()
    
    api.getApiData()
    .then(

        result => {
      
            if (validate.urlsite(result[0].site_exceptions, result[0].site_mirror, result[0].site_url)) {
                // виджет(кнопка я телефоном)
                if (Number(result[0].active_widget)) {

                    document.body.appendChild(create.createPhoneElement())

                    document.querySelector('.phone-popup-module').addEventListener('click', function(e) {

                        callPopupClosePage('click') 
                
                    })
                }

                // попап при закрытии страницы
                if (Number(result[0].active_closeform)) {

                    document.querySelector('body').addEventListener('mouseleave', function(e) {

                        if (classPopup.popup) {
                            if (e.clientY &lt; 0) {
                                callPopupClosePage('mouseleave')
                            }
                        }
                    })
                }

                //попап по времени 
                if (Number(result[0].active_discount)) {

                    setTimeout(function(){
                        if (classPopup.popupTime) {
                            callPopupTime()
                        }
                    }, result[0].form_discount_timeout * classPopup._factor)
                }
            }
        }
    ).catch(e => {
        console.log('Ошибка работы API!', e)
    })

    /**
     * Добавляет попап при закрытии страницы
     * @param {String} e событие 
     */
    function callPopupClosePage(e) {

        add.addPopupAtPage(create.createElementPopup().block, create.createElementPopup().class)
    
        e === 'mouseleave' ? classPopup.popup = !classPopup.popup : null;
    }

    /**
     * Добавляет попап по времени
     */
    function callPopupTime() {

        add.addPopupAtPage(create.createElementPopupTime())

        classPopup.popupTime = !classPopup.popupTime

    }

    function appendLink() {

        let head = document.head,
            link = document.createElement('link');

        link.rel = "stylesheet";
        link.href = "https://stat.sitemanage.ru/jsPopup/popupmodule.css";
        link.media = 'none'

        link.onload = function() {
            if (link.media === 'none') {
               
                link.setAttribute('media', 'all')
            }
        }

        head.appendChild(link)
    }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Message.html">Message</a></li><li><a href="module.exports.html">exports</a></li><li><a href="Validate.html">Validate</a></li><li><a href="XHR.html">XHR</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addPopup">addPopup</a></li><li><a href="global.html#addPopupAndAnimate">addPopupAndAnimate</a></li><li><a href="global.html#addTitleAndSubtitle">addTitleAndSubtitle</a></li><li><a href="global.html#closePopup">closePopup</a></li><li><a href="global.html#getApiData">getApiData</a></li><li><a href="global.html#inputChangeHeader">inputChangeHeader</a></li><li><a href="global.html#inputChangePostHeader">inputChangePostHeader</a></li><li><a href="global.html#openOption">openOption</a></li><li><a href="global.html#phoneMask">phoneMask</a></li><li><a href="global.html#saveOption">saveOption</a></li><li><a href="global.html#sendEmailViaAjax">sendEmailViaAjax</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Wed Aug 14 2019 16:32:50 GMT+0300 (GMT+03:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
